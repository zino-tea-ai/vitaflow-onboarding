<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NogicOS - AI 原生浏览器</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="ai-effects.css">
</head>
<body>
    <!-- 顶部工具栏 -->
    <div class="toolbar">
        <!-- 窗口控制 -->
        <div class="window-controls">
            <div class="window-btn close"></div>
            <div class="window-btn minimize"></div>
            <div class="window-btn maximize"></div>
        </div>

        <!-- 导航按钮 -->
        <div class="nav-buttons">
            <button class="nav-btn" id="btn-back" title="后退">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <button class="nav-btn" id="btn-forward" title="前进">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
            <button class="nav-btn" id="btn-refresh" title="刷新">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6"/>
                    <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
            </button>
        </div>

        <!-- URL 栏 -->
        <div class="url-bar">
            <div class="url-icon">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
                </svg>
            </div>
            <input type="text" id="url-input" placeholder="输入网址或搜索...">
            <div class="loading-indicator" id="loading-indicator"></div>
        </div>

        <!-- 连接状态 -->
        <div class="connection-status" id="connection-status">
            <div class="status-dot disconnected"></div>
            <span>未连接</span>
        </div>

        <!-- AI 按钮 -->
        <button class="ai-toggle-btn" id="ai-toggle-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a2 2 0 110 4h-1a7 7 0 01-7 7h-1v1.27c.6.34 1 .99 1 1.73a2 2 0 11-4 0c0-.74.4-1.39 1-1.73V18h-1a7 7 0 01-7-7H2a2 2 0 110-4h1a7 7 0 017-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 012-2z"/>
            </svg>
            <span>AI</span>
        </button>
    </div>

    <!-- 网页内容区域 (使用 webview 替代 BrowserView) -->
    <webview id="browser-view" src="https://news.ycombinator.com" style="width:100%; height: calc(100vh - 80px);"></webview>

    <!-- AI 执行面板 -->
    <div class="ai-panel" id="ai-panel">
        <div class="ai-panel-header">
            <div class="panel-tabs">
                <button class="tab-btn active" data-tab="execution">执行</button>
                <button class="tab-btn" data-tab="learn">学习</button>
                <button class="tab-btn" data-tab="skills">技能库</button>
            </div>
            <button class="panel-close-btn" id="panel-close-btn">×</button>
        </div>

        <!-- 执行视图 -->
        <div class="tab-content active" id="tab-execution">
            <!-- 模型选择器 -->
            <div class="model-selector">
                <label for="model-select">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    模型
                </label>
                <select id="model-select">
                    <option value="gpt-5.2">GPT-5.2 Thinking</option>
                    <option value="gpt-5.2-pro">GPT-5.2 Pro</option>
                    <option value="claude-opus-4-5-20251101">Claude Opus 4.5</option>
                    <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
                </select>
            </div>
            
            <div class="task-input-area">
                <textarea id="task-input" placeholder="描述你想让 AI 做什么...&#10;例如：获取第一条新闻标题、点击某个链接"></textarea>
                <div class="task-actions">
                    <button class="execute-btn" id="execute-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        执行
                    </button>
                    <button class="stop-btn" id="stop-btn" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12"/>
                        </svg>
                        停止
                    </button>
                </div>
            </div>

            <!-- 执行状态 -->
            <div class="execution-status" id="execution-status">
                <div class="status-header">
                    <span class="status-title">等待任务...</span>
                    <span class="status-time" id="status-time"></span>
                </div>
            </div>

            <!-- 步骤列表 -->
            <div class="steps-container" id="steps-container">
                <!-- 动态生成的步骤卡片 -->
            </div>
        </div>

        <!-- 学习视图 -->
        <div class="tab-content" id="tab-learn">
            <div class="learn-input-area">
                <p class="learn-description">让 AI 自动探索并学习当前网站的操作技能</p>
                <button class="learn-btn" id="learn-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2zM22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/>
                    </svg>
                    开始学习
                </button>
            </div>

            <!-- 学习进度 -->
            <div class="learn-progress" id="learn-progress">
                <div class="progress-info">
                    <span class="progress-text">准备就绪</span>
                    <span class="progress-count">0 / 0</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <!-- 发现的技能 -->
            <div class="discovered-skills" id="discovered-skills">
                <h4>发现的技能</h4>
                <div class="skills-list" id="discovered-skills-list">
                    <!-- 动态生成 -->
                </div>
            </div>
        </div>

        <!-- 技能库视图 -->
        <div class="tab-content" id="tab-skills">
            <div class="skills-search">
                <input type="text" id="skills-search" placeholder="搜索技能...">
            </div>
            <div class="skills-library" id="skills-library">
                <div class="empty-state">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M4 19.5A2.5 2.5 0 016.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/>
                    </svg>
                    <p>暂无技能</p>
                    <span>学习网站后，技能将显示在这里</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 技能详情弹窗 -->
    <div class="skill-modal" id="skill-modal">
        <div class="skill-modal-content">
            <div class="skill-modal-header">
                <h3 id="skill-modal-title">技能名称</h3>
                <button class="modal-close-btn" id="modal-close-btn">×</button>
            </div>
            <div class="skill-modal-body" id="skill-modal-body">
                <!-- 动态内容 -->
            </div>
        </div>
    </div>

    <!-- #region agent log -->
    <script>
    fetch('http://127.0.0.1:7242/ingest/1146cc51-3fe3-46a3-9e1a-4801e1a50de0',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:inline',message:'HTML loaded, DOM ready check',data:{toolbarExists:!!document.querySelector('.toolbar'),bodyChildren:document.body.children.length},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'C'})}).catch(()=>{});
    </script>
    <!-- #endregion -->
    <script src="ai-overlay.js"></script>
    <script src="app.js"></script>
</body>
</html>
