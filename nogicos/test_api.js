const express=require("express");const http=require("http");const app=express();app.use(express.json({limit:"50mb"}));app.post("/api/chat",(req,res)=>{const m=req.body.message;console.log("Recv:",m?.length||0);if(!m)return res.status(400).json({e:1});res.json({ok:1,len:m.length});});const s=app.listen(3004,()=>{console.log("UP");const msg="x".repeat(10000);const p=JSON.stringify({message:msg});console.log("Send:",msg.length);const r=http.request({hostname:"localhost",port:3004,path:"/api/chat",method:"POST",headers:{"Content-Type":"application/json"}},rs=>{let d="";rs.on("data",c=>d+=c);rs.on("end",()=>{console.log("St:",rs.statusCode,"Rs:",d);s.close(()=>process.exit(0));});});r.on("error",e=>{console.log("Er:",e.message);s.close();});r.write(p);r.end();});
